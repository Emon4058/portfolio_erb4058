<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Project — Case Study | Emon Roy Bappy</title>
    <meta name="description" content="Project case study — cover, specs, sections, gallery, and outcomes." />
    <style>
        :root {
            --bg: #ffffff;
            --text: #0f172a;
            --muted: #475569;
            --border: #e5e7eb;
            --card: #ffffff;
            --primary: #0ea5e9;
            --content-w: 840px;
            /* Notion-like width */
            --side-w: 260px;
            --radius: 8px;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.04), 0 8px 24px rgba(15, 23, 42, .08);
        }

        * {
            box-sizing: border-box
        }

        html {
            scroll-behavior: smooth
        }

        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
        }

        a {
            color: #2563eb;
            text-decoration: none
        }

        a:hover {
            text-decoration: underline
        }

        /* Topbar (simple) */
        .topbar {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--card);
            border-bottom: 1px solid var(--border);
        }

        .topbar-inner {
            max-width: calc(var(--content-w) + var(--side-w) + 64px);
            margin: 0 auto;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .brand {
            font-weight: 700;
            color: var(--primary)
        }

        .back {
            color: var(--muted)
        }

        /* Cover */
        .cover {
            max-width: calc(var(--content-w) + var(--side-w) + 64px);
            margin: 12px auto 0;
            padding: 0 16px;
        }

        .cover img {
            width: 100%;
            height: 260px;
            object-fit: cover;
            border-radius: var(--radius);
            display: block;
            border: 1px solid var(--border);
        }

        .cover figcaption {
            font-size: 12px;
            color: var(--muted);
            margin-top: 6px;
        }

        /* Main layout: content + toc */
        .page {
            max-width: calc(var(--content-w) + var(--side-w) + 64px);
            margin: 18px auto 40px;
            padding: 0 16px;
            display: grid;
            grid-template-columns: var(--content-w) var(--side-w);
            gap: 32px;
            align-items: start;
        }

        @media (max-width: 1100px) {
            .page {
                grid-template-columns: 1fr;
            }

            aside.toc {
                display: none;
            }
        }

        /* Title + meta */
        h1#title {
            font-size: clamp(28px, 5vw, 40px);
            line-height: 1.2;
            margin: 8px 0 6px;
            font-weight: 700;
        }

        .meta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin: 6px 0 12px;
            color: var(--muted);
            font-size: 14px;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px
        }

        .tag {
            background: #f1f5f9;
            color: #0f172a;
            border: 1px solid #e2e8f0;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
        }

        /* Properties (Notion-like key/value table) */
        .properties {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--card);
            box-shadow: var(--shadow);
            padding: 8px 0;
            margin: 12px 0 20px;
        }

        .prop {
            display: grid;
            grid-template-columns: 180px 1fr;
            gap: 12px;
            padding: 8px 14px;
            align-items: baseline;
        }

        .prop+.prop {
            border-top: 1px solid var(--border);
        }

        .prop .k {
            color: var(--muted);
            font-size: 13px;
        }

        .prop .v {
            font-weight: 500;
        }

        /* Content blocks */
        .block {
            margin: 22px 0;
        }

        .block h2 {
            font-size: clamp(20px, 3vw, 26px);
            margin: 0 0 8px;
            padding-top: 12px;
            border-top: 1px solid rgba(0, 0, 0, 0.04);
        }

        .block p {
            margin: 0 0 10px;
        }

        .split {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            align-items: start;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 12px;
        }

        .split-media img {
            width: 100%;
            height: auto;
            border-radius: 6px;
            display: block;
            border: 1px solid var(--border);
        }

        .caption {
            font-size: 12px;
            color: var(--muted);
            margin-top: 6px;
        }

        /* Blog-style images block inside sections */
        .images-list {
            display: grid;
            gap: 12px;
        }

        .images-list figure {
            margin: 0;
        }

        .images-list img {
            width: 100%;
            height: auto;
            border-radius: 6px;
            border: 1px solid var(--border);
            display: block;
        }

        .images-list figcaption {
            font-size: 12px;
            color: var(--muted);
            margin-top: 6px;
        }

        /* Gallery */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
        }

        .thumb {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .thumb img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .thumb figcaption {
            font-size: 12px;
            color: var(--muted);
            padding: 8px;
        }

        /* Callout */
        .callout {
            border-left: 4px solid var(--primary);
            background: #f0f9ff;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px;
        }

        /* TOC (sticky) */
        aside.toc {
            position: sticky;
            top: 96px;
            border-left: 1px solid var(--border);
            padding-left: 16px;
        }

        .toc h3 {
            font-size: 14px;
            color: var(--muted);
            margin: 6px 0 8px;
        }

        .toc ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .toc li {
            margin: 6px 0;
        }

        .toc a {
            color: #334155;
            text-decoration: none;
            font-size: 14px;
        }

        .toc a.active {
            color: #111827;
            font-weight: 600;
        }

        /* Footer */
        .footer {
            text-align: center;
            color: #64748b;
            padding: 32px 16px;
            border-top: 1px solid var(--border);
            max-width: calc(var(--content-w) + var(--side-w) + 64px);
            margin: 32px auto 0;
        }

        /* Toggle dropdowns + table */
        .toggle {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--card);
            box-shadow: var(--shadow);
            margin: 12px 0;
        }

        .toggle-header {
            width: 100%;
            background: transparent;
            border: 0;
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 600;
            text-align: left;
        }

        .toggle-header .chev {
            display: inline-flex;
            transition: transform .2s ease;
            font-size: 16px;
        }

        .toggle.open .toggle-header .chev {
            transform: rotate(90deg);
        }

        .toggle-body {
            display: none;
            padding: 8px 12px 12px;
            border-top: 1px solid var(--border);
        }

        .toggle.open .toggle-body {
            display: block;
        }

        .table-wrap {
            overflow-x: auto;
        }

        .spec-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .spec-table th,
        .spec-table td {
            border: 1px solid var(--border);
            padding: 8px 10px;
            text-align: left;
            vertical-align: top;
        }

        .spec-table th {
            background: #f8fafc;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <header class="topbar">
        <div class="topbar-inner">
            <a class="brand" href="../../index.html">Project</a>
            <a class="back" href="../../index.html#projects">← Back to Projects</a>
        </div>
    </header>

    <!-- Cover -->
    <figure class="cover">
        <img id="coverImg" src="" alt="Project cover" />
        <figcaption id="coverCap"></figcaption>
    </figure>

    <div class="page">
        <main id="content">
            <h1 id="title">Project Title</h1>

            <div class="meta-row">
                <div id="meta"></div>
            </div>

            <div class="tags" id="tags"></div>

            <div id="propsWrap" class="properties" style="display:none"></div>
            <!-- Dynamic tables (from JSON) -->
            <div id="tables"></div>

            <!-- Dynamic sections -->
            <div id="blocks"></div>

            <!-- Gallery -->
            <section id="gallerySec" class="block" style="display:none">
                <h2>Gallery</h2>
                <div id="gallery" class="gallery"></div>
            </section>

            <!-- Iterations -->
            <section id="iterationsSec" class="block" style="display:none">
                <h2>Design Iterations</h2>
                <ul id="iterations"></ul>
            </section>

            <!-- Outcomes -->
            <section id="outcomesSec" class="block" style="display:none">
                <h2>Outcomes</h2>
                <ul id="outcomes"></ul>
            </section>

            <!-- Callout CTA -->
            <section class="block">
                <div class="callout">
                    Interested in deeper details or the workflow? I’m happy to walk through the model.
                    <div style="margin-top:8px">
                        <a id="contactBtn" href="mailto:emonroy4058@gmail.com?subject=Project%20Inquiry">Get in
                            touch</a>
                    </div>
                </div>
            </section>
        </main>

        <!-- Table of contents -->
        <aside class="toc">
            <h3>Table of contents</h3>
            <ul id="toc"></ul>
        </aside>
    </div>

    <footer class="footer"> 2025 | Emon Roy Bappy</footer>

    <script>
        (function () {
            const params = new URLSearchParams(location.search);
            const slugParam = params.get("slug");
            const idxParam = parseInt(params.get("i"), 10);
            const PROFILE_URL = "../../data/profile.json";

            const slugify = (s) => (s || "").toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g, "");
            const resolveAsset = (src) => {
                if (!src) return "";
                if (/^https?:\/\//i.test(src) || src.startsWith("/")) return src;
                if (src.startsWith("assets/")) return "../../" + src.replace(/^\.?\/*/, "");
                if (src.startsWith("../")) return src;
                return "../../" + src.replace(/^\.?\/*/, "");
            };

            fetch(PROFILE_URL)
                .then(r => r.json())
                .then(profile => {
                    let project = null;
                    if (slugParam) project = profile.projects.find(p => slugify(p.slug || p.title) === slugParam);
                    if (!project) project = Number.isInteger(idxParam) && profile.projects[idxParam] ? profile.projects[idxParam] : profile.projects[0];
                    if (!project) throw new Error("No project found");

                    const title = project.title || "Project";
                    document.title = `${title} — Case Study | Emon Roy Bappy`;

                    // Cover
                    const imgsRaw = (project.gallery && project.gallery.length ? project.gallery : [project.image]).filter(Boolean);
                    const imgs = imgsRaw.map(resolveAsset);
                    const cover = document.getElementById("coverImg");
                    cover.src = imgs[0] || "";
                    cover.alt = `${title} — cover`;
                    document.getElementById("coverCap").textContent = title;

                    // Title
                    document.getElementById("title").textContent = title;


                    // Meta badges (free-form text from project.meta)
                    const meta = Array.isArray(project.meta) ? project.meta : [];
                    const metaEl = document.getElementById("meta");
                    metaEl.innerHTML = meta.map(m => `<span>${m}</span>`).join("");

                    // Tags
                    const tagsEl = document.getElementById("tags");
                    tagsEl.innerHTML = (project.tags || []).map(t => `<span class="tag">${t}</span>`).join("");

                    // Properties/specs (Notion-like table)
                    const specs = Array.isArray(project.specs) ? project.specs : [];
                    const propsWrap = document.getElementById("propsWrap");
                    if (specs.length) {
                        propsWrap.style.display = "";
                        propsWrap.innerHTML = specs.map(s => `
              <div class="prop"><div class="k">${s.k}</div><div class="v">${s.v}</div></div>
            `).join("");
                    }

                    // Normalize tables defined as object or array
                    function normalizeTables(tables, order) {
                        if (!tables) return [];
                        let arr = [];

                        // If object: convert to array, preserve order via tablesOrder if provided
                        if (!Array.isArray(tables) && typeof tables === "object") {
                            const keys = Array.isArray(order) && order.length ? order
                                : Object.keys(tables); // insertion order fallback
                            arr = keys.map((key) => {
                                const t = tables[key] || {};
                                return {
                                    id: (t.id || key).toString(),
                                    title: t.title || key,
                                    collapsed: !!t.collapsed,
                                    columns: Array.isArray(t.columns) && t.columns.length ? t.columns : ["Functionality", "Specification"],
                                    rows: t.rows
                                };
                            });
                        } else if (Array.isArray(tables)) {
                            arr = tables.map((t, i) => ({
                                id: (t.id || t.title || `table-${i}`).toString(),
                                title: t.title || `Table ${i + 1}`,
                                collapsed: !!t.collapsed,
                                columns: Array.isArray(t.columns) && t.columns.length ? t.columns : ["Functionality", "Specification"],
                                rows: t.rows
                            }));
                        }

                        // Normalize rows: support array-of-arrays or object map
                        arr.forEach(t => {
                            if (t && t.rows && !Array.isArray(t.rows) && typeof t.rows === "object") {
                                t.rows = Object.entries(t.rows);
                            }
                            if (!Array.isArray(t.rows)) t.rows = [];
                        });

                        return arr;
                    }

                    function fillSpecTable(tableEl, columns, rows) {
                        const thead = tableEl.querySelector("thead");
                        const tbody = tableEl.querySelector("tbody");
                        thead.innerHTML = `<tr>${columns.map(c => `<th>${c}</th>`).join("")}</tr>`;
                        tbody.innerHTML = rows.map(r => {
                            const cells = Array.isArray(r) ? r : [r.k, r.v];
                            return `<tr>${cells.slice(0, columns.length).map(c => `<td>${c ?? ""}</td>`).join("")}</tr>`;
                        }).join("");
                    }
                    const tablesWrap = document.getElementById("tables");
                    const tocExtras = []; // we'll merge into sectionIds later

                    const tablesArr = normalizeTables(project.tables, project.tablesOrder);
                    if (tablesWrap && tablesArr.length) {
                        tablesWrap.innerHTML = tablesArr.map(t => {
                            const secId = "table-" + slugify(t.id || t.title);
                            // Add to TOC later
                            tocExtras.push({ id: secId, label: t.title });
                            return `
      <section class="block toggle ${t.collapsed ? "" : "open"}" id="${secId}">
        <button class="toggle-header" type="button" aria-expanded="${t.collapsed ? "false" : "true"}">
          <span class="chev">▸</span> <span>${t.title}</span>
        </button>
        <div class="toggle-body">
          <div class="table-wrap">
            <table class="spec-table">
              <thead></thead><tbody></tbody>
            </table>
          </div>
        </div>
      </section>
    `;
                        }).join("");

                        // Fill table rows and wire toggles
                        tablesArr.forEach((t, i) => {
                            const secId = "table-" + slugify(t.id || t.title);
                            const sec = document.getElementById(secId);
                            const tbl = sec.querySelector("table.spec-table");
                            fillSpecTable(tbl, t.columns, t.rows);

                            const header = sec.querySelector(".toggle-header");
                            header?.addEventListener("click", () => {
                                const open = sec.classList.toggle("open");
                                header.setAttribute("aria-expanded", open ? "true" : "false");
                            });
                        });
                    }
                    const sections = Array.isArray(project.sections) ? project.sections : [];
                    const blocks = document.getElementById("blocks");
                    const makeId = (h) => "sec-" + slugify(h || ("section-" + Math.random().toString(36).slice(2, 7)));
                    const sectionIds = [];

                    // Add dynamic tables to TOC
                    tocExtras.forEach(t => sectionIds.push(t));

                    // Helper: paragraphs from text (split by blank line)
                    const renderParas = (txt) =>
                        (txt || "").trim().split(/\n{1,2}\s*\n/).map(p => `<p>${p.trim()}</p>`).join("");

                    // Helper: images block (supports s.image or s.images[])
                    function renderImagesBlock(s, headingForAlt) {
                        // s.images can be ["url", ...] or [{src, caption}, ...]
                        const list = Array.isArray(s.images) && s.images.length
                            ? s.images.map(item => (typeof item === "string" ? { src: item } : item))
                            : (s.image ? [{ src: s.image, caption: s.caption }] : []);

                        if (!list.length) return "";

                        const figures = list.map((it, i) => {
                            const src = resolveAsset(it.src || it.url || "");
                            const cap = it.caption || "";
                            const alt = `${headingForAlt || "Section"} image ${i + 1}`;
                            return `
      <figure>
        <img src="${src}" alt="${alt}">
        ${cap ? `<figcaption>${cap}</figcaption>` : ""}
      </figure>
    `;
                        }).join("");

                        return `<div class="images-list">${figures}</div>`;
                    }

                    let htmlParts = [];

                    // 1) Description section (from longDescription or description)
                    const descText = (project.longDescription || project.description || "").trim();
                    if (descText) {
                        const descId = "descSec";
                        htmlParts.push(`
    <section class="block" id="${descId}">
      <h2>Description</h2>
      <div class="split">
        <div class="split-text">
          ${renderParas(descText)}
        </div>
      </div>
    </section>
  `);
                        sectionIds.push({ id: descId, label: "Description" });
                    }

                    // 2) Blog-style sections: images + text
                    if (sections.length) {
                        sections.forEach((s, i) => {
                            const id = makeId(s.heading || `Section ${i + 1}`);
                            sectionIds.push({ id, label: s.heading || `Section ${i + 1}` });
                            htmlParts.push(`
      <section class="block" id="${id}">
        <h2>${s.heading || ""}</h2>
        <div class="split">
          ${renderImagesBlock(s, s.heading || title)}
          <div class="split-text">
            ${renderParas(s.text || "")}
          </div>
        </div>
      </section>
    `);
                        });
                    } else {
                        if (imgs[1]) {
                            const id = makeId("Overview");
                            sectionIds.push({ id, label: "Overview" });
                            htmlParts.push(`
      <section class="block" id="${id}">
        <h2>Overview</h2>
        <div class="split">
          <div class="images-list">
            <figure>
              <img src="${imgs[1]}" alt="${title} image 2">
            </figure>
          </div>
          <div class="split-text"></div>
        </div>
      </section>
    `);
                        }
                    }

                    blocks.innerHTML = htmlParts.join("");

                    // Gallery
                    const gallerySec = document.getElementById("gallerySec");
                    const gallery = document.getElementById("gallery");
                    if (imgs.length > 1) {
                        gallerySec.style.display = "";
                        gallery.innerHTML = imgs.map((src, i) => `
              <figure class="thumb">
                <img src="${src}" alt="${title} image ${i + 1}">
                <figcaption>${title} — image ${i + 1}</figcaption>
              </figure>
            `).join("");
                        sectionIds.push({ id: "gallerySec", label: "Gallery" });
                    }

                    // Iterations
                    if (Array.isArray(project.iterations) && project.iterations.length) {
                        document.getElementById("iterationsSec").style.display = "";
                        document.getElementById("iterations").innerHTML =
                            project.iterations.map(it => `<li>${it}</li>`).join("");
                        sectionIds.push({ id: "iterationsSec", label: "Design Iterations" });
                    }

                    // Outcomes
                    if (Array.isArray(project.outcomes) && project.outcomes.length) {
                        document.getElementById("outcomesSec").style.display = "";
                        document.getElementById("outcomes").innerHTML =
                            project.outcomes.map(o => `<li>${o}</li>`).join("");
                        sectionIds.push({ id: "outcomesSec", label: "Outcomes" });
                    }

                    // Contact subject
                    const subject = encodeURIComponent(`${title} — Inquiry`);
                    const contactBtn = document.getElementById("contactBtn");
                    contactBtn.href = `mailto:emonroy4058@gmail.com?subject=${subject}`;

                    // Build TOC
                    const toc = document.getElementById("toc");
                    toc.innerHTML = sectionIds.map(s => `<li><a href="#${s.id}">${s.label}</a></li>`).join("");

                    // Scroll spy (highlight active section)
                    const links = Array.from(toc.querySelectorAll("a"));
                    const map = new Map(links.map(a => [a.getAttribute("href").slice(1), a]));
                    const io = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            const id = entry.target.id;
                            const link = map.get(id);
                            if (!link) return;
                            if (entry.isIntersecting) {
                                links.forEach(l => l.classList.remove("active"));
                                link.classList.add("active");
                            }
                        });
                    }, { rootMargin: "-40% 0px -55% 0px", threshold: 0.01 });

                    sectionIds.forEach(s => {
                        const el = document.getElementById(s.id);
                        if (el) io.observe(el);
                    });
                })
                .catch(err => {
                    console.error("Failed to load project:", err);
                    document.body.innerHTML = '<p style="padding:24px">Could not load this project. <a href="../../index.html#projects">Back to projects</a></p>';
                });
        })();
    </script>
</body>

</html>